import cucumber.api.java.en.Given;
import cucumber.api.java.en.Then;
import cucumber.api.java.en.When;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Assert;

public class MyStepDefinitions {
    private String jsonResponse;
    private boolean found;

    @Given("^the JSON response is \"(.*)\"$")
    public void the_JSON_response_is(String jsonResponse) {
        this.jsonResponse = jsonResponse;
    }

    @When("^I check if compId \"(.*)\" and userId \"(.*)\" are present$")
    public void i_check_if_compId_and_userId_are_present(String compId, String userId) {
        ObjectMapper objectMapper = new ObjectMapper();
        JsonNode rootNode;
        try {
            rootNode = objectMapper.readTree(jsonResponse);
        } catch (Exception e) {
            throw new RuntimeException("Error parsing JSON: " + e.getMessage());
        }

        JsonNode dataArray = rootNode.get("data");

        for (JsonNode dataNode : dataArray) {
            String dataCompId = dataNode.get("compId").asText();
            String dataUserId = dataNode.get("userId").asText();

            if (dataCompId.equals(compId) && dataUserId.equals(userId)) {
                found = true;
                break;
            }
        }
    }

    @Then("^both compId and userId should be present in the JSON response$")
    public void both_compId_and_userId_should_be_present_in_the_JSON_response() {
        Assert.assertTrue("Both compId and userId should be present", found);
    }
}